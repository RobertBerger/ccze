## Rules.mk -- Common variables and rules for all Makefiles  -*- Makefile -*-

SHELL		= /bin/sh

PACKAGE		= ccze
VERSION		= 0.1.${PATCHLEVEL}

PROGRAM		= ${PACKAGE}
VPATH		= ${srcdir}

## -- User modifiable variables -- ##
prefix		= @prefix@
exec_prefix	= @exec_prefix@
sysconfdir	= @sysconfdir@
bindir		= @bindir@
mandir		= @mandir@
man1dir		= ${mandir}/man1
libdir		= @libdir@
pkglibdir	= ${libdir}/${PACKAGE}

CC		= @CC@
CFLAGS		= @CFLAGS@
LDFLAGS		= @LDFLAGS@
TAR		= tar
GZIP		= gzip
TAR_OPTIONS	=
GZIP_ENV	= --best

ETAGS		= etags

INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@
INSTALL_DIR	= @INSTALL@ -d
EXTRAVERSION	=

## -- Private variables -- ##
ifeq (${subdir},)
top_builddir	= .
else
top_builddir	= ..
endif
builddir	= @builddir@

PATCHLEVEL	= $(shell head -5 ${top_srcdir}/ChangeLog | tail -1 | sed -e "s,^.*patch-,,g")
DISTFILES	= ${SOURCES} ${HEADERS} Makefile.in ${EXTRA_DIST}

INCLUDES	= -I. -I${srcdir} -I${top_builddir}
DEFINES		= -DPATCHLEVEL=\"${PATCHLEVEL}\" -DSYSCONFDIR=\"${sysconfdir}\" \
		-D_GNU_SOURCE=1 -DPKGLIBDIR=\"${pkglibdir}\"
WFLAGS		= -Werror -Wshadow -Wpointer-arith -Waggregate-return \
		-Wstrict-prototypes -Wmissing-prototypes -Wcast-qual \
		-Wbad-function-cast -Wsign-compare -Wchar-subscripts \
		-Wcomment -Wformat -Wformat-nonliteral -Wformat-security \
		-Wimplicit -Wmain -Wmissing-braces -Wparentheses \
		-Wreturn-type -Wswitch -Wmulticharacter \
		-Wmissing-noreturn -Wmissing-declarations @WFLAGS_3X@
WFLAGS_3X	= -Wsequence-point -Wdiv-by-zero -W -Wunused \
		-Wno-unused-parameter -Wno-unused-function
ALL_CFLAGS	= ${INCLUDES} ${DEFINES} ${WFLAGS} ${CFLAGS}

LIBS		= @LIBS@

## -- Generic rules -- ##
all:

TAGS:: ${SOURCES} ${HEADERS}
	test -z "${SOURCES}${HEADERS}" || ${ETAGS} ${SOURCES} ${HEADERS}

.c.o:
	${CC} -c ${CPPFLAGS} ${ALL_CFLAGS} $<
%.so: ccze-%.c ccze.h
	${CC} -fPIC -DPIC ${ALL_CFLAGS} ${ALL_LDFLAGS} -o $@ $< -shared

mostlyclean clean::
	rm -f *~ ${PROGRAM} ${OBJECTS} TAGS
	test -z "${CLEANFILES}" || rm -rf ${CLEANFILES}
distclean:: clean
	rm -f Makefile
	test -z "${DISTCLEANFILES}" || rm -rf ${DISTCLEANFILES}
maintainer-clean:: distclean
	test -z "${MAINTCLEANFILES}" || rm -rf ${MAINTCLEANFILES}

distdir = ${top_builddir}/${PACKAGE}-${VERSION}/${subdir}
distdir: ${DISTFILES}
	${INSTALL_DIR} ${distdir}
	@list='${DISTFILES}'; for f in $$list; do \
		echo cp -p ${srcdir}/$$f ${distdir}/$$f ;\
		cp -p ${srcdir}/$$f ${distdir}/$$f ;\
	done

${top_builddir}/Rules.mk: ${top_srcdir}/Rules.mk.in ${top_builddir}/config.status
	cd ${top_builddir} && ./config.status
${builddir}/Makefile: ${srcdir}/Makefile.in ${top_builddir}/config.status
	cd ${top_builddir} && ./config.status

## -- ${MAKE} control -- ##
.PHONY: all install clean distclean mostlyclean uninstall maintainer-clean \
	distdir dist distcheck
.SUFFIXES:
.SUFFIXES: .c .o
.DEFAULT: all
