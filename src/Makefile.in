## src/Makefile

## -- User-modifiable variables -- ##
srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
subdir		= src

## == The code below shouldn't need to be touched at all == ##

include ../Rules.mk

## -- Private variables -- ##
ALL_LDFLAGS	= ${LDFLAGS} ${LIBS}

SOURCES		= ccze.c ccze-color.c ccze-plugin.c ccze-wordcolor.c \
		$(addprefix ccze-,$(addsuffix .c, ${PLUGINS}))
HEADERS		= ccze.h ccze-color.h ccze-plugin.h ccze-wordcolor.h \
		$(addprefix ccze-,$(addsuffix .h, ${PLUGINS}))
PLUGINS		= httpd procmail squid sulog super syslog vsftpd
PLUGIN_OBJS	= $(addsuffix .so,${PLUGINS})
CLEANFILES	= ${OBJECTS:.o=.da} ${PLUGIN_OBJS}
OBJECTS		= ccze.o ccze-color.o ccze-plugin.o ccze-wordcolor.o

## -- Standard targets -- ##
all: ${PROGRAM} ${PLUGIN_OBJS}

install: all
	${INSTALL} -d ${DESTDIR}${bindir}
	${INSTALL_PROGRAM} ${PROGRAM} ${DESTDIR}${bindir}/
	${INSTALL} -d ${DESTDIR}${pkglibdir}
	${INSTALL_DATA} ${PLUGIN_OBJS} ${DESTDIR}${pkglibdir}/

install-strip:
	${MAKE} INSTALL_PROGRAM='${INSTALL_PROGRAM} -s' \
		INSTALL_DATA='${INSTALL_DATA} -s' install

uninstall:
	rm -f ${DESTDIR}${bindir}/${PROGRAM}
	rm -f $(addprefix ${DESTDIR}${pkglibdir}/,${PLUGIN_OBJS})

## -- Specific targets -- ##
${PROGRAM}: ${OBJECTS}
	${CC} -rdynamic ${ALL_CFLAGS} -o $@ $^ ${ALL_LDFLAGS}

## -- Dependencies -- ##
ccze.o: ccze.c ${top_builddir}/system.h ccze.h ccze-color.h ccze-plugin.h \
	ccze-wordcolor.h
ccze-color.o: ccze-color.c ${top_builddir}/system.h ccze.h ccze-color.h
ccze-plugin.o: ccze-plugin.c ${top_builddir}/system.h ccze.h ccze-plugin.h
ccze-wordcolor.o: ccze-wordcolor.c ${top_builddir}/system.h ccze.h \
		  ccze-wordcolor.h

ccze-httpd.so: ccze-httpd.c ${top_builddir}/system.h ccze.h ccze-httpd.h
ccze-procmail.so: ccze-procmail.c ${top_builddir}/system.h ccze.h ccze-procmail.h
ccze-squid.so: ccze-squid.c ${top_builddir}/system.h ccze.h ccze-squid.h
ccze-sulog.so: ccze-sulog.c ${top_builddir}/system.h ccze.h ccze-sulog.h
ccze-super.so: ccze-super.c ${top_builddir}/system.h ccze.h ccze-super.h
ccze-syslog.so: ccze-syslog.c $(top_builddir)/system.h ccze.h ccze-syslog.h
ccze-vsftpd.so: ccze-vsftpd.c ${top_builddir}/system.h ccze.h ccze-vsftpd.h
${top_builddir}/system.h: ${top_builddir}/config.status
