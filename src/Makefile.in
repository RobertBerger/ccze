## src/Makefile

## -- User-modifiable variables -- ##
srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
subdir		= src

## == The code below shouldn't need to be touched at all == ##

include ../Rules.mk

## -- Private variables -- ##
ALL_LDFLAGS	= ${LDFLAGS} ${LIBS}

SOURCES		= ccze.c ccze-color.c ccze-plugin.c ccze-wordcolor.c \
		$(addprefix ccze-,$(addsuffix .c, ${PLUGINS})) \
		ccze-dump.c
HEADERS		= ccze.h ccze-color.h ccze-plugin.h ccze-wordcolor.h
PLUGINS		= apm exim httpd procmail squid sulog super syslog \
		ulogd vsftpd
PLUGIN_OBJS	= $(addsuffix .so,${PLUGINS})
CLEANFILES	= ${OBJECTS:.o=.da} ${PLUGIN_OBJS} ccze-dump
OBJECTS		= ccze.o ccze-color.o ccze-plugin.o ccze-wordcolor.o

## -- Standard targets -- ##
all: ${PROGRAM} ${PLUGIN_OBJS} ccze-dump

install: all
	${INSTALL} -d ${DESTDIR}${bindir}
	${INSTALL_PROGRAM} ${PROGRAM} ${DESTDIR}${bindir}/
	${INSTALL} -d ${DESTDIR}${pkglibdir}
	${INSTALL_DATA} ${PLUGIN_OBJS} ${DESTDIR}${pkglibdir}/

install-strip:
	${MAKE} INSTALL_PROGRAM='${INSTALL_PROGRAM} -s' \
		INSTALL_DATA='${INSTALL_DATA} -s' install

uninstall:
	rm -f ${DESTDIR}${bindir}/${PROGRAM}
	rm -f $(addprefix ${DESTDIR}${pkglibdir}/,${PLUGIN_OBJS})

## -- Specific targets -- ##
${PROGRAM}: ${OBJECTS}
	${CC} -rdynamic ${ALL_CFLAGS} -o $@ $^ ${ALL_LDFLAGS}
ccze-dump: ccze-dump.c ccze-color.c ccze.h ccze-color.h
	${CC} ${ALL_CFLAGS} -o $@ ccze-dump.c

## -- Dependencies -- ##
ccze.o: ccze.c ${top_builddir}/system.h ccze.h ccze-color.h ccze-plugin.h \
	ccze-wordcolor.h
ccze-color.o: ccze-color.c ${top_builddir}/system.h ccze.h ccze-color.h
ccze-plugin.o: ccze-plugin.c ${top_builddir}/system.h ccze.h ccze-plugin.h
ccze-wordcolor.o: ccze-wordcolor.c ${top_builddir}/system.h ccze.h \
		  ccze-wordcolor.h
ulogd.so: ccze-ulogd.c ccze.h ccze-plugin.h ccze-wordcolor.h
${top_builddir}/system.h: ${top_builddir}/config.status
